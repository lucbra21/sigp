{% extends 'layouts/base.html' %}
{% block content %}
<div class="container py-4">
  <div class="row g-4">
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-body">
          <h5 class="mb-3">Firma del Presidente (PAdES)</h5>
          <p>Se firmará el contrato actual del prescriptor con el certificado configurado.</p>
          <form id="presidentSignForm" method="post" action="{{ url_for('contracts.sign_president_post') }}" onsubmit="showLoader()">
            <input type="hidden" name="token" value="{{ token }}">
            <button class="btn btn-primary" type="submit">Firmar ahora</button>
          </form>
          <p class="text-muted small mt-3">
            Verificá que el contenido del PDF sea el correcto antes de firmar.
          </p>
        </div>
      </div>
    </div>
    <div class="col-12 col-lg-6">
      <div class="card h-100">
        <div class="card-body">
          <h6 class="mb-2">Vista previa del contrato</h6>
          {% if prescriptor and prescriptor.contract_url %}
          <div class="ratio ratio-1x1" style="min-height:420px;">
            <iframe src="{{ prescriptor.contract_url }}#view=fitH" title="Contrato" style="width:100%;height:100%;border:1px solid #ddd;border-radius:6px;"></iframe>
          </div>
          <div class="mt-2">
            <a class="btn btn-sm btn-outline-secondary" target="_blank" href="{{ prescriptor.contract_url }}">Abrir en nueva pestaña</a>
          </div>
          {% else %}
          <div class="alert alert-warning mb-0">No se encontró el PDF del contrato para previsualizar.</div>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
</div>
<script>
  function showLoader(){
    const overlay = document.getElementById('globalLoading');
    if (overlay){ overlay.classList.remove('d-none'); overlay.classList.add('d-flex'); }
  }
  // También mostrar si se activa con tecla Enter dentro del formulario
  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('presidentSignForm');
    if(form){ form.addEventListener('submit', showLoader); }
  });
</script>
{% endblock %}
