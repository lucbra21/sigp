{% extends 'layouts/base.html' %}
{% block title %}Histórico Lead{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
  <h2 class="fw-semibold mb-0">Histórico de Movimientos</h2>
  <a href="{{ url_for('leads.my_leads') }}" class="btn btn-loading btn-secondary"><i class="bi bi-arrow-left"></i> Volver</a>
</div>
<!-- Loading overlay reutilizado -->
<div id="leadsLoading" class="position-fixed top-0 start-0 w-100 h-100 d-none justify-content-center align-items-center" style="background:rgba(255,255,255,.7);z-index:1050;">
  <img src="{{ url_for('static', filename='img/loader.gif') }}" alt="cargando...">
</div>

<script>
  const ov=document.getElementById('leadsLoading');
  document.querySelectorAll('.btn-loading').forEach(b=>b.addEventListener('click',()=>{
    if(ov){ov.classList.remove('d-none');ov.classList.add('d-flex');}
  }));
</script>

<div class="card shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
    <thead>
        <tr>
            <th>Fecha</th>
            <th>Estado</th>
            <th>Usuario</th>
            <th>Observaciones</th>
        </tr>
    </thead>
    <tbody>
        {% for h in history %}
        <tr>
            <td>{{ h.changed_at.strftime('%d/%m/%Y %H:%M') }}</td>
            <td>{{ state_map.get(h.state_id, h.state_id) }}</td>
            <td>{{ user_map.get(h.changed_by, h.changed_by) }}</td>
            <td>{{ h.observations or '-' }}</td>
        </tr>
        {% endfor %}
    </tbody>
    </table>
  </div>
</div>
{% if not history %}<p>No hay movimientos registrados.</p>{% endif %}
{% endblock %}
