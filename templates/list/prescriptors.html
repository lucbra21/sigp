{% extends 'layouts/base.html' %}
{% block title %}Listado de Prescriptores{% endblock %}
{% block content %}
<h2>Prescriptores</h2>
<a href="{{ url_for('prescriptors.new_prescriptor') }}" class="btn btn-primary mb-3">Nuevo Prescriptor</a>

<!-- Filtros -->
<form class="row row-cols-lg-auto g-2 align-items-end mb-3" method="get">
    <div class="col-12">
        <label for="fNombre" class="form-label">Nombre</label>
        <input type="text" class="form-control" id="fNombre" name="nombre" value="{{ filters.nombre }}">
    </div>
    <div class="col-12">
        <label for="fTipo" class="form-label">Tipo</label>
        <select id="fTipo" name="tipo" class="form-select">
            <option value="">- Todos -</option>
            {% for val, lbl in type_choices %}
            <option value="{{ val }}" {% if filters.tipo==val %}selected{% endif %}>{{ lbl }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-12">
        <label for="fEstado" class="form-label">Estado</label>
        <select id="fEstado" name="estado" class="form-select">
            <option value="">- Todos -</option>
            {% for val, lbl in state_choices %}
            <option value="{{ val }}" {% if filters.estado==val %}selected{% endif %}>{{ lbl }}</option>
            {% endfor %}
        </select>
    </div>
    <div class="col-12">
        <button type="submit" class="btn btn-secondary">Filtrar</button>
    </div>
</form>
<table class="table table-striped">
    <thead>
        <tr>
            <th>ID</th>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>Estado</th>
            <th>Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for p in items %}
        <tr>
            <td>{{ p.id }}</td>
            <td>{{ p.nombre }}</td>
            <td>{{ p.tipo }}</td>
            <td>{{ p.estado }}</td>
            <td>
                <a href="{{ url_for('prescriptors.edit_prescriptor', prescriptor_id=p.id) }}" class="btn btn-sm btn-secondary">Editar</a>
                {% if can('update_prescriptor_commission') %}
                <a href="{{ url_for('prescriptors.prescriptor_commissions', prescriptor_id=p.id) }}" class="btn btn-sm btn-warning">Comisiones</a>
                {% endif %}
                <a href="{{ url_for('landing.landing_page', prescriptor_id=p.id) }}" target="_blank" class="btn btn-sm btn-info">Squeeze Page</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- PaginaciÃ³n simple -->
<nav aria-label="Page navigation">
    <ul class="pagination">
        {% if page > 1 %}
        <li class="page-item"><a class="page-link" href="?page={{ page - 1 }}">Anterior</a></li>
        {% endif %}
        {% if total > page * per_page %}
        <li class="page-item"><a class="page-link" href="?page={{ page + 1 }}">Siguiente</a></li>
        {% endif %}
    </ul>
</nav>
{% endblock %}
