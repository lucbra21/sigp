{% extends 'layouts/base.html' %}
{% block title %}Mis leads{% endblock %}
{% block content %}
<h2>Mis leads</h2>
<form method="get" class="row g-2 align-items-end mb-3">
  <div class="col-md-3">
    <label class="form-label">Candidato</label>
    <input type="text" name="candidate" value="{{ filters.candidate }}" class="form-control" placeholder="Nombre">
  </div>
  <div class="col-md-2">
    <label class="form-label">Estado</label>
    <select name="state" class="form-select">
      <option value="">Todos</option>
      {% for sid, sname in state_choices %}
      <option value="{{ sid }}" {% if filters.state==sid|string %}selected{% endif %}>{{ sname }}</option>
      {% endfor %}
    </select>
  </div>
  <div class="col-md-2">
    <label class="form-label">Desde</label>
    <input type="date" name="from" value="{{ filters.from }}" class="form-control">
  </div>
  <div class="col-md-2">
    <label class="form-label">Hasta</label>
    <input type="date" name="to" value="{{ filters.to }}" class="form-control">
  </div>
  <div class="col-md-2">
    <button type="submit" class="btn btn-secondary w-100">Filtrar</button>
  </div>
</form>
<table class="table table-bordered table-sm">
  <thead>
    <tr>
      <th>Fecha</th>
      <th>Candidato</th>
      <th>Email</th>
      <th>Celular</th>
      <th>Programa</th>
      <th>Estado</th>
    </tr>
  </thead>
  <tbody>
  {% for l in leads %}
    <tr>
      <td>{{ l.created_at.strftime('%d/%m/%Y') if l.created_at }}</td>
      <td>{{ l.candidate_name }}</td>
      <td>{{ l.candidate_email or '-'}}</td>
      <td>{{ l.candidate_cellular or '-'}}</td>
      <td>{{ program_map.get(l.program_info_id, '-') }}</td>
      <td>{{ state_map.get(l.state_id, l.state_id) }}</td>
    </tr>
  {% endfor %}
  </tbody>
</table>
{% if total==0 %}<p>No hay leads.</p>{% endif %}
{% endblock %}
