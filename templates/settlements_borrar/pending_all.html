{% extends 'layouts/base.html' %}
{% block title %}Facturas pendientes de rendición{% endblock %}
{% block content %}
<div class="container py-4">
  <h3>Facturas pendientes de rendición</h3>
  <form class="row row-cols-lg-auto g-2 align-items-end mb-3" method="get" action="{{ url_for('settlements.pending_all') }}">
    <div class="col-12">
      <label for="presc" class="form-label">Prescriptor</label>
      <select id="presc" class="form-select" name="prescriptor_id">
        <option value="">-- Todos --</option>
        {% for p in prescriptors %}
        <option value="{{ p.id }}" {% if p.id|string == presc_sel|string %}selected{% endif %}>{{ (p|attr(label_attr)) if label_attr else p.id }}</option>
        {% endfor %}
      </select>
    </div>
    <div class="col-12">
      <label for="date_from" class="form-label">Desde</label>
      <input type="date" class="form-control" id="date_from" name="date_from" value="{{ date_from }}">
    </div>
    <div class="col-12">
      <label for="date_to" class="form-label">Hasta</label>
      <input type="date" class="form-control" id="date_to" name="date_to" value="{{ date_to }}">
    </div>
    <div class="col-12">
      <button class="btn btn-outline-secondary">Filtrar</button>
    </div>
    {% if presc_sel %}
    <div class="col-12">
      <a class="btn btn-primary" href="{{ url_for('settlements.pending_invoices', prescriptor_id=presc_sel) }}">Rendir facturas</a>
    </div>
    {% endif %}
  </form>

  <table class="table table-striped table-sm">
    <thead>
      <tr>
        <th>ID</th>
        <th>Prescriptor</th>
        <th>Fecha</th>
        <th>Total</th>
      </tr>
    </thead>
    <tbody>
      {% for inv in invoices %}
      <tr>
        <td>{{ inv.id }}</td>
        <td>{{ presc_map[inv.prescriptor_id] }}</td>
        <td>{{ inv.invoice_date }}</td>
        <td>{{ '%.2f'|format(inv.total) }}</td>
      </tr>
      {% else %}
      <tr><td colspan="4" class="text-center">No hay facturas pendientes</td></tr>
      {% endfor %}
    </tbody>
  </table>
</div>
{% endblock %}
