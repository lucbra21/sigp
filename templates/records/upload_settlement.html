{% extends 'layouts/base.html' %}
{% block title %}Generar rendición{% endblock %}
{% block content %}
<h2>Generar rendición</h2>
<div>
  
  <form action="{{ url_for('settlements.settle') }}" method="post" enctype="multipart/form-data">
  <input type="hidden" name="prescriptor_id" value="{{ prescriptor_id }}">
  <h4>Facturas pendientes</h4>
  <table class="table table-sm table-bordered">
    <thead>
      <tr><th><input type="checkbox" id="selAll"></th><th>ID</th><th>Fecha</th><th>Importe</th><th></th></tr>
    </thead>
    <tbody>
      {% for inv in invoices %}
      <tr>
        <td><input type="checkbox" name="invoice_ids" value="{{ inv.id }}" class="chk-row"></td>
        <td>{{ inv.id }}</td>
        <td>{{ inv.invoice_date }}</td>
        <td class="amt">{{ '%.2f'|format(inv.total) }}</td>
        <td><a class="btn btn-outline-secondary btn-sm" target="_blank" href="{{ url_for('settlements.invoice_detail', invoice_id=inv.id) }}">Ver</a></td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
  {% if invoices|length == 0 %}<p>No hay facturas pendientes.</p>{% endif %}
  <div class="mb-3 mt-3">
    <label class="form-label">Comprobante (PDF/JPG/PNG)</label>
    <input type="file" name="receipt" class="form-control" required>
  </div>
  <button class="btn btn-success" {% if invoices|length == 0 %}disabled{% endif %}>Guardar rendición</button>
</form>
</div>
<script>
const selAll=document.getElementById('selAll');
if(selAll){
  const chkRows=document.querySelectorAll('.chk-row');
  selAll.addEventListener('change',()=>chkRows.forEach(cb=>cb.checked=selAll.checked));
}
</script>
{% endblock %}
