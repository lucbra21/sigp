{% extends 'layouts/base.html' %}
{% block title %}Nueva nota {{ 'de crédito' if note_type=='C' else 'de débito' }}{% endblock %}
{% block content %}
<h2 class="fw-semibold mb-4 text-center">Nueva nota {{ 'de crédito' if note_type=='C' else 'de débito' }}</h2>
<div class="card shadow-sm border border-secondary-subtle bg-light mx-auto" style="max-width: 600px;">
  <div class="card-body">
<form method="post" class="card card-body" id="noteForm">
  <div class="mb-2">
    <label class="form-label">Prescriptor</label>
    <select name="prescriptor_id" class="form-select" required>
      {% for p in prescriptors %}<option value="{{ p.id }}">{{ p.name }}</option>{% endfor %}
    </select>
  </div>
  <div class="mb-2">
    <label class="form-label">Monto</label>
    <input type="number" step="0.01" name="amount" class="form-control" required>
  </div>
  <div class="mb-2">
    <label class="form-label">Fecha</label>
    <input type="date" name="date" class="form-control" value="{{ today }}">
  </div>
  <div class="mb-2">
    <label class="form-label">Concepto</label>
    <input type="text" name="concept" class="form-control">
  </div>

  <div class="col-12 text-center pt-3">
    <button class="btn btn-primary me-2">Guardar</button>
    <a href="{{ url_for('adjustments.adjustments_page') }}" class="btn btn-secondary" id="cancelAdjustment">Volver</a>
  </div>

  <!-- Loading overlay -->
<div id="adjustmentNoteLoading" class="position-fixed top-0 start-0 w-100 h-100 d-none justify-content-center align-items-center" style="background:rgba(255,255,255,.7);z-index:1050;">
  <img src="{{ url_for('static', filename='img/loader.gif') }}" alt="cargando...">
</div>

  
</form>
</div>
</div>
<script>
  document.addEventListener('DOMContentLoaded', function(){
    const form = document.getElementById('noteForm');
    const overlay = document.getElementById('adjustmentNoteLoading');
    if(form){
      form.addEventListener('submit', function(){
        if(form.checkValidity()){
          overlay.classList.remove('d-none');
          overlay.classList.add('d-flex');
        }
      });
    }
    const cancelBtn = document.getElementById('cancelAdjustment');
    if(cancelBtn){
      cancelBtn.addEventListener('click', function(){
        overlay.classList.remove('d-none');
        overlay.classList.add('d-flex');
      });
    }
  });
</script>
{% endblock %}
